// X axis
float SX0 = -Tbs[1][0]*q2 + Tbs[1][1]*q1 + Tbs[1][2]*q0;
float SX1 = Tbs[1][0]*q3 + Tbs[1][1]*q0 - Tbs[1][2]*q1;
float SX2 = Tbs[1][0]*q0 - Tbs[1][1]*q3 + Tbs[1][2]*q2;
float SX3 = SX0*vd + SX1*ve + SX2*vn;
float SX4 = 1.0F/range;
float SX5 = 2*SX4;
float SX6 = Tbs[1][0]*q1 + Tbs[1][1]*q2 + Tbs[1][2]*q3;
float SX7 = -SX0*ve + SX1*vd + SX6*vn;
float SX8 = SX0*vn - SX2*vd + SX6*ve;
float SX9 = -SX1*vn + SX2*ve + SX6*vd;
float SX10 = q0*q2;
float SX11 = q1*q3;
float SX12 = 2*Tbs[1][2];
float SX13 = q0*q3;
float SX14 = q1*q2;
float SX15 = 2*Tbs[1][1];
float SX16 = powf(q1, 2);
float SX17 = powf(q2, 2);
float SX18 = -SX17;
float SX19 = powf(q0, 2);
float SX20 = powf(q3, 2);
float SX21 = SX19 - SX20;
float SX22 = SX12*(SX10 + SX11) - SX15*(SX13 - SX14) + Tbs[1][0]*(SX16 + SX18 + SX21);
float SX23 = 2*Tbs[1][0];
float SX24 = q0*q1;
float SX25 = q2*q3;
float SX26 = -SX16;
float SX27 = -SX12*(SX24 - SX25) + SX23*(SX13 + SX14) + Tbs[1][1]*(SX17 + SX21 + SX26);
float SX28 = SX15*(SX24 + SX25) - SX23*(SX10 - SX11) + Tbs[1][2]*(SX18 + SX19 + SX20 + SX26);
float SX29 = 2*SX3;
float SX30 = 2*SX7;
float SX31 = 2*SX8;
float SX32 = 2*SX9;
float SX33 = P[0][0]*SX29 + P[0][1]*SX30 + P[0][2]*SX31 + P[0][3]*SX32 + P[0][4]*SX22 + P[0][5]*SX27 + P[0][6]*SX28;
float SX34 = powf(range, -2);
float SX35 = P[0][6]*SX29 + P[1][6]*SX30 + P[2][6]*SX31 + P[3][6]*SX32 + P[4][6]*SX22 + P[5][6]*SX27 + P[6][6]*SX28;
float SX36 = P[0][5]*SX29 + P[1][5]*SX30 + P[2][5]*SX31 + P[3][5]*SX32 + P[4][5]*SX22 + P[5][5]*SX27 + P[5][6]*SX28;
float SX37 = P[0][4]*SX29 + P[1][4]*SX30 + P[2][4]*SX31 + P[3][4]*SX32 + P[4][4]*SX22 + P[4][5]*SX27 + P[4][6]*SX28;
float SX38 = P[0][2]*SX29 + P[1][2]*SX30 + P[2][2]*SX31 + P[2][3]*SX32 + P[2][4]*SX22 + P[2][5]*SX27 + P[2][6]*SX28;
float SX39 = P[0][3]*SX29 + P[1][3]*SX30 + P[2][3]*SX31 + P[3][3]*SX32 + P[3][4]*SX22 + P[3][5]*SX27 + P[3][6]*SX28;
float SX40 = P[0][1]*SX29 + P[1][1]*SX30 + P[1][2]*SX31 + P[1][3]*SX32 + P[1][4]*SX22 + P[1][5]*SX27 + P[1][6]*SX28;
float SX41 = SX4/(R_LOS + SX22*SX34*SX37 + SX27*SX34*SX36 + SX28*SX34*SX35 + SX29*SX33*SX34 + SX30*SX34*SX40 + SX31*SX34*SX38 + SX32*SX34*SX39);


H_LOS[0] = SX3*SX5;
H_LOS[1] = SX5*SX7;
H_LOS[2] = SX5*SX8;
H_LOS[3] = SX5*SX9;
H_LOS[4] = SX22*SX4;
H_LOS[5] = SX27*SX4;
H_LOS[6] = SX28*SX4;
H_LOS[7] = 0;
H_LOS[8] = 0;
H_LOS[9] = 0;
H_LOS[10] = 0;
H_LOS[11] = 0;
H_LOS[12] = 0;
H_LOS[13] = 0;
H_LOS[14] = 0;
H_LOS[15] = 0;
H_LOS[16] = 0;
H_LOS[17] = 0;
H_LOS[18] = 0;
H_LOS[19] = 0;
H_LOS[20] = 0;
H_LOS[21] = 0;
H_LOS[22] = 0;
H_LOS[23] = 0;


Kfusion[0] = SX33*SX41;
Kfusion[1] = SX40*SX41;
Kfusion[2] = SX38*SX41;
Kfusion[3] = SX39*SX41;
Kfusion[4] = SX37*SX41;
Kfusion[5] = SX36*SX41;
Kfusion[6] = SX35*SX41;
Kfusion[7] = SX41*(P[0][7]*SX29 + P[1][7]*SX30 + P[2][7]*SX31 + P[3][7]*SX32 + P[4][7]*SX22 + P[5][7]*SX27 + P[6][7]*SX28);
Kfusion[8] = SX41*(P[0][8]*SX29 + P[1][8]*SX30 + P[2][8]*SX31 + P[3][8]*SX32 + P[4][8]*SX22 + P[5][8]*SX27 + P[6][8]*SX28);
Kfusion[9] = SX41*(P[0][9]*SX29 + P[1][9]*SX30 + P[2][9]*SX31 + P[3][9]*SX32 + P[4][9]*SX22 + P[5][9]*SX27 + P[6][9]*SX28);
Kfusion[10] = SX41*(P[0][10]*SX29 + P[1][10]*SX30 + P[2][10]*SX31 + P[3][10]*SX32 + P[4][10]*SX22 + P[5][10]*SX27 + P[6][10]*SX28);
Kfusion[11] = SX41*(P[0][11]*SX29 + P[1][11]*SX30 + P[2][11]*SX31 + P[3][11]*SX32 + P[4][11]*SX22 + P[5][11]*SX27 + P[6][11]*SX28);
Kfusion[12] = SX41*(P[0][12]*SX29 + P[1][12]*SX30 + P[2][12]*SX31 + P[3][12]*SX32 + P[4][12]*SX22 + P[5][12]*SX27 + P[6][12]*SX28);
Kfusion[13] = SX41*(P[0][13]*SX29 + P[1][13]*SX30 + P[2][13]*SX31 + P[3][13]*SX32 + P[4][13]*SX22 + P[5][13]*SX27 + P[6][13]*SX28);
Kfusion[14] = SX41*(P[0][14]*SX29 + P[1][14]*SX30 + P[2][14]*SX31 + P[3][14]*SX32 + P[4][14]*SX22 + P[5][14]*SX27 + P[6][14]*SX28);
Kfusion[15] = SX41*(P[0][15]*SX29 + P[1][15]*SX30 + P[2][15]*SX31 + P[3][15]*SX32 + P[4][15]*SX22 + P[5][15]*SX27 + P[6][15]*SX28);
Kfusion[16] = SX41*(P[0][16]*SX29 + P[1][16]*SX30 + P[2][16]*SX31 + P[3][16]*SX32 + P[4][16]*SX22 + P[5][16]*SX27 + P[6][16]*SX28);
Kfusion[17] = SX41*(P[0][17]*SX29 + P[1][17]*SX30 + P[2][17]*SX31 + P[3][17]*SX32 + P[4][17]*SX22 + P[5][17]*SX27 + P[6][17]*SX28);
Kfusion[18] = SX41*(P[0][18]*SX29 + P[1][18]*SX30 + P[2][18]*SX31 + P[3][18]*SX32 + P[4][18]*SX22 + P[5][18]*SX27 + P[6][18]*SX28);
Kfusion[19] = SX41*(P[0][19]*SX29 + P[1][19]*SX30 + P[2][19]*SX31 + P[3][19]*SX32 + P[4][19]*SX22 + P[5][19]*SX27 + P[6][19]*SX28);
Kfusion[20] = SX41*(P[0][20]*SX29 + P[1][20]*SX30 + P[2][20]*SX31 + P[3][20]*SX32 + P[4][20]*SX22 + P[5][20]*SX27 + P[6][20]*SX28);
Kfusion[21] = SX41*(P[0][21]*SX29 + P[1][21]*SX30 + P[2][21]*SX31 + P[3][21]*SX32 + P[4][21]*SX22 + P[5][21]*SX27 + P[6][21]*SX28);
Kfusion[22] = SX41*(P[0][22]*SX29 + P[1][22]*SX30 + P[2][22]*SX31 + P[3][22]*SX32 + P[4][22]*SX22 + P[5][22]*SX27 + P[6][22]*SX28);
Kfusion[23] = SX41*(P[0][23]*SX29 + P[1][23]*SX30 + P[2][23]*SX31 + P[3][23]*SX32 + P[4][23]*SX22 + P[5][23]*SX27 + P[6][23]*SX28);


// Y axis
float SY0 = Tbs[0][1]*q1;
float SY1 = Tbs[0][2]*q0;
float SY2 = Tbs[0][0]*q2;
float SY3 = SY0 + SY1 - SY2;
float SY4 = Tbs[0][0]*q3;
float SY5 = Tbs[0][1]*q0;
float SY6 = Tbs[0][2]*q1;
float SY7 = SY4 + SY5 - SY6;
float SY8 = Tbs[0][0]*q0;
float SY9 = Tbs[0][2]*q2;
float SY10 = Tbs[0][1]*q3;
float SY11 = -SY10 + SY8 + SY9;
float SY12 = SY11*vn + SY3*vd + SY7*ve;
float SY13 = 1.0F/range;
float SY14 = 2*SY13;
float SY15 = Tbs[0][0]*q1 + Tbs[0][1]*q2 + Tbs[0][2]*q3;
float SY16 = SY15*vn + SY7*vd;
float SY17 = SY16 - SY3*ve;
float SY18 = SY15*ve + SY3*vn;
float SY19 = -SY11*vd + SY18;
float SY20 = SY11*ve + SY15*vd;
float SY21 = SY20 - SY7*vn;
float SY22 = q0*q3;
float SY23 = q1*q2;
float SY24 = 2*Tbs[0][1];
float SY25 = powf(q1, 2);
float SY26 = powf(q2, 2);
float SY27 = -SY26;
float SY28 = powf(q0, 2);
float SY29 = powf(q3, 2);
float SY30 = SY28 - SY29;
float SY31 = q0*q2;
float SY32 = q1*q3;
float SY33 = 2*Tbs[0][2];
float SY34 = SY33*(SY31 + SY32) + Tbs[0][0]*(SY25 + SY27 + SY30);
float SY35 = -SY24*(SY22 - SY23) + SY34;
float SY36 = q0*q1;
float SY37 = q2*q3;
float SY38 = -SY25;
float SY39 = 2*Tbs[0][0];
float SY40 = SY39*(SY22 + SY23) + Tbs[0][1]*(SY26 + SY30 + SY38);
float SY41 = -SY33*(SY36 - SY37) + SY40;
float SY42 = SY24*(SY36 + SY37) + Tbs[0][2]*(SY27 + SY28 + SY29 + SY38);
float SY43 = -SY39*(SY31 - SY32) + SY42;
float SY44 = 2*SY12;
float SY45 = 2*SY16 + 2*ve*(-SY0 - SY1 + SY2);
float SY46 = 2*SY18 + 2*vd*(SY10 - SY8 - SY9);
float SY47 = 2*SY20 + 2*vn*(-SY4 - SY5 + SY6);
float SY48 = SY24*(-SY22 + SY23) + SY34;
float SY49 = SY33*(-SY36 + SY37) + SY40;
float SY50 = SY39*(-SY31 + SY32) + SY42;
float SY51 = P[0][0]*SY44 + P[0][1]*SY45 + P[0][2]*SY46 + P[0][3]*SY47 + P[0][4]*SY48 + P[0][5]*SY49 + P[0][6]*SY50;
float SY52 = powf(range, -2);
float SY53 = P[0][6]*SY44 + P[1][6]*SY45 + P[2][6]*SY46 + P[3][6]*SY47 + P[4][6]*SY48 + P[5][6]*SY49 + P[6][6]*SY50;
float SY54 = P[0][5]*SY44 + P[1][5]*SY45 + P[2][5]*SY46 + P[3][5]*SY47 + P[4][5]*SY48 + P[5][5]*SY49 + P[5][6]*SY50;
float SY55 = P[0][4]*SY44 + P[1][4]*SY45 + P[2][4]*SY46 + P[3][4]*SY47 + P[4][4]*SY48 + P[4][5]*SY49 + P[4][6]*SY50;
float SY56 = P[0][2]*SY44 + P[1][2]*SY45 + P[2][2]*SY46 + P[2][3]*SY47 + P[2][4]*SY48 + P[2][5]*SY49 + P[2][6]*SY50;
float SY57 = 2*SY52;
float SY58 = P[0][3]*SY44 + P[1][3]*SY45 + P[2][3]*SY46 + P[3][3]*SY47 + P[3][4]*SY48 + P[3][5]*SY49 + P[3][6]*SY50;
float SY59 = P[0][1]*SY44 + P[1][1]*SY45 + P[1][2]*SY46 + P[1][3]*SY47 + P[1][4]*SY48 + P[1][5]*SY49 + P[1][6]*SY50;
float SY60 = SY13/(R_LOS + SY17*SY57*SY59 + SY19*SY56*SY57 + SY21*SY57*SY58 + SY35*SY52*SY55 + SY41*SY52*SY54 + SY43*SY52*SY53 + SY44*SY51*SY52);


H_LOS[0] = -SY12*SY14;
H_LOS[1] = -SY14*SY17;
H_LOS[2] = -SY14*SY19;
H_LOS[3] = -SY14*SY21;
H_LOS[4] = -SY13*SY35;
H_LOS[5] = -SY13*SY41;
H_LOS[6] = -SY13*SY43;
H_LOS[7] = 0;
H_LOS[8] = 0;
H_LOS[9] = 0;
H_LOS[10] = 0;
H_LOS[11] = 0;
H_LOS[12] = 0;
H_LOS[13] = 0;
H_LOS[14] = 0;
H_LOS[15] = 0;
H_LOS[16] = 0;
H_LOS[17] = 0;
H_LOS[18] = 0;
H_LOS[19] = 0;
H_LOS[20] = 0;
H_LOS[21] = 0;
H_LOS[22] = 0;
H_LOS[23] = 0;


Kfusion[0] = -SY51*SY60;
Kfusion[1] = -SY59*SY60;
Kfusion[2] = -SY56*SY60;
Kfusion[3] = -SY58*SY60;
Kfusion[4] = -SY55*SY60;
Kfusion[5] = -SY54*SY60;
Kfusion[6] = -SY53*SY60;
Kfusion[7] = -SY60*(P[0][7]*SY44 + P[1][7]*SY45 + P[2][7]*SY46 + P[3][7]*SY47 + P[4][7]*SY48 + P[5][7]*SY49 + P[6][7]*SY50);
Kfusion[8] = -SY60*(P[0][8]*SY44 + P[1][8]*SY45 + P[2][8]*SY46 + P[3][8]*SY47 + P[4][8]*SY48 + P[5][8]*SY49 + P[6][8]*SY50);
Kfusion[9] = -SY60*(P[0][9]*SY44 + P[1][9]*SY45 + P[2][9]*SY46 + P[3][9]*SY47 + P[4][9]*SY48 + P[5][9]*SY49 + P[6][9]*SY50);
Kfusion[10] = -SY60*(P[0][10]*SY44 + P[1][10]*SY45 + P[2][10]*SY46 + P[3][10]*SY47 + P[4][10]*SY48 + P[5][10]*SY49 + P[6][10]*SY50);
Kfusion[11] = -SY60*(P[0][11]*SY44 + P[1][11]*SY45 + P[2][11]*SY46 + P[3][11]*SY47 + P[4][11]*SY48 + P[5][11]*SY49 + P[6][11]*SY50);
Kfusion[12] = -SY60*(P[0][12]*SY44 + P[1][12]*SY45 + P[2][12]*SY46 + P[3][12]*SY47 + P[4][12]*SY48 + P[5][12]*SY49 + P[6][12]*SY50);
Kfusion[13] = -SY60*(P[0][13]*SY44 + P[1][13]*SY45 + P[2][13]*SY46 + P[3][13]*SY47 + P[4][13]*SY48 + P[5][13]*SY49 + P[6][13]*SY50);
Kfusion[14] = -SY60*(P[0][14]*SY44 + P[1][14]*SY45 + P[2][14]*SY46 + P[3][14]*SY47 + P[4][14]*SY48 + P[5][14]*SY49 + P[6][14]*SY50);
Kfusion[15] = -SY60*(P[0][15]*SY44 + P[1][15]*SY45 + P[2][15]*SY46 + P[3][15]*SY47 + P[4][15]*SY48 + P[5][15]*SY49 + P[6][15]*SY50);
Kfusion[16] = -SY60*(P[0][16]*SY44 + P[1][16]*SY45 + P[2][16]*SY46 + P[3][16]*SY47 + P[4][16]*SY48 + P[5][16]*SY49 + P[6][16]*SY50);
Kfusion[17] = -SY60*(P[0][17]*SY44 + P[1][17]*SY45 + P[2][17]*SY46 + P[3][17]*SY47 + P[4][17]*SY48 + P[5][17]*SY49 + P[6][17]*SY50);
Kfusion[18] = -SY60*(P[0][18]*SY44 + P[1][18]*SY45 + P[2][18]*SY46 + P[3][18]*SY47 + P[4][18]*SY48 + P[5][18]*SY49 + P[6][18]*SY50);
Kfusion[19] = -SY60*(P[0][19]*SY44 + P[1][19]*SY45 + P[2][19]*SY46 + P[3][19]*SY47 + P[4][19]*SY48 + P[5][19]*SY49 + P[6][19]*SY50);
Kfusion[20] = -SY60*(P[0][20]*SY44 + P[1][20]*SY45 + P[2][20]*SY46 + P[3][20]*SY47 + P[4][20]*SY48 + P[5][20]*SY49 + P[6][20]*SY50);
Kfusion[21] = -SY60*(P[0][21]*SY44 + P[1][21]*SY45 + P[2][21]*SY46 + P[3][21]*SY47 + P[4][21]*SY48 + P[5][21]*SY49 + P[6][21]*SY50);
Kfusion[22] = -SY60*(P[0][22]*SY44 + P[1][22]*SY45 + P[2][22]*SY46 + P[3][22]*SY47 + P[4][22]*SY48 + P[5][22]*SY49 + P[6][22]*SY50);
Kfusion[23] = -SY60*(P[0][23]*SY44 + P[1][23]*SY45 + P[2][23]*SY46 + P[3][23]*SY47 + P[4][23]*SY48 + P[5][23]*SY49 + P[6][23]*SY50);


